--- # SMACHA demo script for using a FollowJointTrajectoryAction with the Baxter simulator.
name: sm
template: BaxterBase
node_name: baxter_smacha_joint_traj_test
outcomes: [succeeded, aborted, preempted]
states:
  - READ_LEFT_LIMB_JOINTS_1:
      template: ReadLimbJointsState
      limb: left
      remapping: {joint_positions: left_limb_joint_positions_1}
      transitions: {succeeded: LEFT_LIMB_OUTWARD_JOINT_MOTION}

  - LEFT_LIMB_OUTWARD_JOINT_MOTION:
      template: FollowJointTrajectoryActionState
      limb: left
      userdata:
        left_limb_outward_traj_points:
          - [-0.11, -0.62, -1.15, 1.32,  0.80, 1.27,  2.39]
          - [x * 0.75 for x in [-0.11, -0.62, -1.15, 1.32,  0.80, 1.27,  2.39]]
          - [x * 1.25 for x in [-0.11, -0.62, -1.15, 1.32,  0.80, 1.27,  2.39]]
        left_limb_outward_traj_times: [0.0, 7.0, 9.0, 12.0]
      input_keys: ['left_limb_joint_positions_1', 'left_limb_outward_traj_points', 'times']
      points_cb: lambda userdata: [userdata.left_limb_joint_positions_1] + userdata.left_limb_outward_traj_points
      remapping: {times:left_limb_outward_traj_times}
      transitions: {succeeded: READ_LEFT_LIMB_JOINTS_2}
  
  - READ_LEFT_LIMB_JOINTS_2:
      template: ReadLimbJointsState
      limb: left
      remapping: {joint_positions: left_limb_joint_positions_2}
      transitions: {succeeded: LEFT_LIMB_RETURN_JOINT_MOTION}
  
  - LEFT_LIMB_RETURN_JOINT_MOTION:
      template: FollowJointTrajectoryActionState
      limb: left
      userdata:
        left_limb_return_traj_times: [0.0, 7.0, 9.0, 12.0]
      input_keys: ['left_limb_joint_positions_1', 'left_limb_joint_positions_2', 'left_limb_outward_traj_points', 'times']
      points_cb: lambda userdata: [userdata.left_limb_joint_positions_2] +
                                   userdata.left_limb_outward_traj_points[::-1][0:-1] +
                                   [ud.left_limb_joint_positions_1]
      remapping: {times:left_limb_return_traj_times}
      transitions: {succeeded: succeeded}
